<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Финансовый трекер</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <!-- Главная страница -->
        <div class="content active" id="main">
            <!-- Фиксированная верхняя часть -->
            <div class="fixed-header">
                <!-- Заголовок -->
                <div class="header">
                    <button class="calendar-button">
                        <span class="material-icons">event</span>
                    </button>
                    <div class="header-title">27 март 2025 г.</div>
                </div>

                <!-- Сводка -->
                <div class="summary-container">
                    <div class="summary-items">
                        <div class="summary-item">
                            <div class="label">Расходы</div>
                            <div class="amount expense">11122 ₽</div>
                        </div>
                        <div class="summary-item">
                            <div class="label">Доходы</div>
                            <div class="amount income">271111 ₽</div>
                        </div>
                        <div class="summary-item">
                            <div class="label">Баланс</div>
                            <div class="amount balance">259989 ₽</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Прокручиваемая область с транзакциями -->
            <div class="transactions-container">
                <div class="transactions">
                    <!-- Группа транзакций за день -->
                    <div class="transaction-group">
                        <div class="transaction-date">27 марта</div>
                        <div class="transaction-list">
                            <!-- Транзакция расхода -->
                            <div class="transaction-item expense">
                                <div class="transaction-icon">
                                    <span class="material-icons">shopping_cart</span>
                                </div>
                                <div class="transaction-info">
                                    <div class="transaction-category">Шоппинг</div>
                                    <div class="transaction-note">Продукты</div>
                                </div>
                                <div class="transaction-amount">-111 ₽</div>
                            </div>
                            <!-- Транзакция дохода -->
                            <div class="transaction-item income">
                                <div class="transaction-icon">
                                    <span class="material-icons">account_balance_wallet</span>
                                </div>
                                <div class="transaction-info">
                                    <div class="transaction-category">Зарплата</div>
                                    <div class="transaction-note">Аванс</div>
                                </div>
                                <div class="transaction-amount">+1 131 ₽</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Остальные страницы -->
        <div id="reports" class="content">
            <!-- Содержимое страницы отчетов -->
        </div>
        <div id="categories" class="content">
            <!-- Содержимое страницы категорий -->
        </div>
        <div id="settings" class="content">
            <!-- Содержимое страницы настроек -->
        </div>

        <!-- Кнопка добавления -->
        <button class="add-button">
            <span class="material-icons">add</span>
        </button>

        <!-- Нижняя навигация -->
        <div class="bottom-nav">
            <div class="nav-item active" data-page="main">
                <span class="material-icons">receipt_long</span>
                <span>Записи</span>
            </div>
            <div class="nav-item" data-page="reports">
                <span class="material-icons">pie_chart</span>
                <span>Отчеты</span>
            </div>
            <div class="nav-item" data-page="categories">
                <span class="material-icons">category</span>
                <span>Категории</span>
            </div>
            <div class="nav-item" data-page="settings">
                <span class="material-icons">settings</span>
                <span>Настройки</span>
            </div>
        </div>

        <!-- Модальные окна -->
        <!-- Модальное окно добавления транзакции -->
        <div class="modal add-transaction-modal">
            <div class="modal-header">
                <div class="title"></div>
            </div>
            <div class="modal-content">
                <form id="transactionForm">
                    <div class="form-group">
                        <label>Сумма</label>
                        <input type="number" id="amount" placeholder="0 ₽" required>
                    </div>
                    <div class="form-group">
                        <label>Дата</label>
                        <input type="date" id="date" required>
                    </div>
                    <div class="form-group">
                        <label>Заметка</label>
                        <input type="text" id="note" placeholder="Добавить заметку">
                    </div>
                    <input type="hidden" id="category">
                    <input type="hidden" id="type">
                    <button type="submit" class="submit-button">Сохранить</button>
                </form>
            </div>
        </div>

        <!-- Модальное окно выбора типа операции -->
        <div class="modal transaction-type-modal">
            <div class="transaction-type-selector">
                <button class="type-button active" data-type="expense">Расход</button>
                <button class="type-button" data-type="income">Доход</button>
                <button class="type-button" data-type="transfer">Перевод</button>
            </div>
            <div class="modal-header">
                <button class="back-button">
                    <span class="material-icons">arrow_back</span>
                </button>
                <div class="title"></div>
            </div>
            <div class="modal-content">
                <!-- Категории расходов -->
                <div class="categories-grid expense-categories active">
                    <div class="category-item" data-category="shopping">
                        <div class="category-icon">
                            <span class="material-icons">shopping_cart</span>
                        </div>
                        <span class="category-name">Шоппинг</span>
                    </div>
                    <div class="category-item" data-category="food">
                        <div class="category-icon">
                            <span class="material-icons">restaurant</span>
                        </div>
                        <span class="category-name">Еда</span>
                    </div>
                    <div class="category-item" data-category="phone">
                        <div class="category-icon">
                            <span class="material-icons">phone_android</span>
                        </div>
                        <span class="category-name">Телефон</span>
                    </div>
                    <div class="category-item" data-category="entertainment">
                        <div class="category-icon">
                            <span class="material-icons">sports_esports</span>
                        </div>
                        <span class="category-name">Развлечения</span>
                    </div>
                    <div class="category-item" data-category="transport">
                        <div class="category-icon">
                            <span class="material-icons">directions_car</span>
                        </div>
                        <span class="category-name">Транспорт</span>
                    </div>
                    <div class="category-item" data-category="health">
                        <div class="category-icon">
                            <span class="material-icons">local_hospital</span>
                        </div>
                        <span class="category-name">Здоровье</span>
                    </div>
                    <div class="category-item" data-category="house">
                        <div class="category-icon">
                            <span class="material-icons">home</span>
                        </div>
                        <span class="category-name">Дом</span>
                    </div>
                    <div class="category-item" data-category="utilities">
                        <div class="category-icon">
                            <span class="material-icons">power</span>
                        </div>
                        <span class="category-name">ЖКХ</span>
                    </div>
                    <div class="category-item" data-category="clothes">
                        <div class="category-icon">
                            <span class="material-icons">checkroom</span>
                        </div>
                        <span class="category-name">Одежда</span>
                    </div>
                    <div class="category-item" data-category="beauty">
                        <div class="category-icon">
                            <span class="material-icons">spa</span>
                        </div>
                        <span class="category-name">Красота</span>
                    </div>
                    <div class="category-item" data-category="education">
                        <div class="category-icon">
                            <span class="material-icons">school</span>
                        </div>
                        <span class="category-name">Образование</span>
                    </div>
                    <div class="category-item" data-category="sports">
                        <div class="category-icon">
                            <span class="material-icons">fitness_center</span>
                        </div>
                        <span class="category-name">Спорт</span>
                    </div>
                    <div class="category-item" data-category="cafe">
                        <div class="category-icon">
                            <span class="material-icons">local_cafe</span>
                        </div>
                        <span class="category-name">Кафе</span>
                    </div>
                    <div class="category-item" data-category="gifts">
                        <div class="category-icon">
                            <span class="material-icons">redeem</span>
                        </div>
                        <span class="category-name">Подарки</span>
                    </div>
                    <div class="category-item" data-category="pets">
                        <div class="category-icon">
                            <span class="material-icons">pets</span>
                        </div>
                        <span class="category-name">Питомцы</span>
                    </div>
                    <div class="category-item" data-category="internet">
                        <div class="category-icon">
                            <span class="material-icons">wifi</span>
                        </div>
                        <span class="category-name">Интернет</span>
                    </div>
                    <div class="category-item" data-category="taxi">
                        <div class="category-icon">
                            <span class="material-icons">local_taxi</span>
                        </div>
                        <span class="category-name">Такси</span>
                    </div>
                    <div class="category-item" data-category="parking">
                        <div class="category-icon">
                            <span class="material-icons">local_parking</span>
                        </div>
                        <span class="category-name">Парковка</span>
                    </div>
                    <div class="category-item" data-category="books">
                        <div class="category-icon">
                            <span class="material-icons">menu_book</span>
                        </div>
                        <span class="category-name">Книги</span>
                    </div>
                    <div class="category-item" data-category="medicine">
                        <div class="category-icon">
                            <span class="material-icons">medication</span>
                        </div>
                        <span class="category-name">Лекарства</span>
                    </div>
                    <div class="category-item" data-category="furniture">
                        <div class="category-icon">
                            <span class="material-icons">chair</span>
                        </div>
                        <span class="category-name">Мебель</span>
                    </div>
                    <div class="category-item" data-category="repair">
                        <div class="category-icon">
                            <span class="material-icons">build</span>
                        </div>
                        <span class="category-name">Ремонт</span>
                    </div>
                    <div class="category-item" data-category="insurance">
                        <div class="category-icon">
                            <span class="material-icons">security</span>
                        </div>
                        <span class="category-name">Страховка</span>
                    </div>
                    <div class="category-item" data-category="subscriptions">
                        <div class="category-icon">
                            <span class="material-icons">subscriptions</span>
                        </div>
                        <span class="category-name">Подписки</span>
                    </div>
                    <div class="category-item" data-category="hobbies">
                        <div class="category-icon">
                            <span class="material-icons">palette</span>
                        </div>
                        <span class="category-name">Хобби</span>
                    </div>
                    <div class="category-item" data-category="cinema">
                        <div class="category-icon">
                            <span class="material-icons">movie</span>
                        </div>
                        <span class="category-name">Кино</span>
                    </div>
                    <div class="category-item" data-category="music">
                        <div class="category-icon">
                            <span class="material-icons">music_note</span>
                        </div>
                        <span class="category-name">Музыка</span>
                    </div>
                    <div class="category-item" data-category="travel">
                        <div class="category-icon">
                            <span class="material-icons">flight</span>
                        </div>
                        <span class="category-name">Путешествия</span>
                    </div>
                    <div class="category-item" data-category="electronics">
                        <div class="category-icon">
                            <span class="material-icons">devices</span>
                        </div>
                        <span class="category-name">Электроника</span>
                    </div>
                    <div class="category-item" data-category="other_expense">
                        <div class="category-icon">
                            <span class="material-icons">more_horiz</span>
                        </div>
                        <span class="category-name">Другое</span>
                    </div>
                </div>

                <!-- Категории доходов -->
                <div class="categories-grid income-categories">
                    <div class="category-item" data-category="salary">
                        <div class="category-icon">
                            <span class="material-icons">account_balance_wallet</span>
                        </div>
                        <span class="category-name">Зарплата</span>
                    </div>
                    <div class="category-item" data-category="investments">
                        <div class="category-icon">
                            <span class="material-icons">trending_up</span>
                        </div>
                        <span class="category-name">Инвестиции</span>
                    </div>
                    <div class="category-item" data-category="part-time">
                        <div class="category-icon">
                            <span class="material-icons">schedule</span>
                        </div>
                        <span class="category-name">Подработка</span>
                    </div>
                    <div class="category-item" data-category="rewards">
                        <div class="category-icon">
                            <span class="material-icons">card_giftcard</span>
                        </div>
                        <span class="category-name">Награды</span>
                    </div>
                    <div class="category-item" data-category="rental">
                        <div class="category-icon">
                            <span class="material-icons">house</span>
                        </div>
                        <span class="category-name">Аренда</span>
                    </div>
                    <div class="category-item" data-category="business">
                        <div class="category-icon">
                            <span class="material-icons">business_center</span>
                        </div>
                        <span class="category-name">Бизнес</span>
                    </div>
                    <div class="category-item" data-category="dividends">
                        <div class="category-icon">
                            <span class="material-icons">paid</span>
                        </div>
                        <span class="category-name">Дивиденды</span>
                    </div>
                    <div class="category-item" data-category="freelance">
                        <div class="category-icon">
                            <span class="material-icons">computer</span>
                        </div>
                        <span class="category-name">Фриланс</span>
                    </div>
                    <div class="category-item" data-category="sales">
                        <div class="category-icon">
                            <span class="material-icons">store</span>
                        </div>
                        <span class="category-name">Продажи</span>
                    </div>
                    <div class="category-item" data-category="other_income">
                        <div class="category-icon">
                            <span class="material-icons">more_horiz</span>
                        </div>
                        <span class="category-name">Другое</span>
                    </div>
                </div>

                <!-- Категории переводов -->
                <div class="categories-grid transfer-categories">
                    <!-- Форма планирования переводов -->
                    <div class="transfer-planner collapsed">
                        <div class="compact-view">
                            <span>Добавить регулярный перевод</span>
                            <span class="material-icons">add_circle_outline</span>
                        </div>
                        <div class="transfer-form">
                            <button class="collapse-button">
                                <span class="material-icons">remove_circle_outline</span>
                            </button>
                            <div class="bank-selector">
                                <div class="bank-from">
                                    <label>Откуда</label>
                                    <select class="bank-select">
                                        <option value="" disabled selected>Выберите банк</option>
                                        <option value="sber">Сбербанк</option>
                                        <option value="tinkoff">Тинькофф</option>
                                        <option value="vtb">ВТБ</option>
                                        <option value="alfa">Альфа-Банк</option>
                                        <option value="gazprom">Газпромбанк</option>
                                        <option value="raif">Райффайзен</option>
                                        <option value="other">Другой...</option>
                                    </select>
                                    <input type="text" class="account-number" placeholder="Номер счёта" />
                                </div>
                                
                                <div class="bank-to">
                                    <label>Куда</label>
                                    <select class="bank-select">
                                        <option value="" disabled selected>Выберите банк</option>
                                        <option value="sber">Сбербанк</option>
                                        <option value="tinkoff">Тинькофф</option>
                                        <option value="vtb">ВТБ</option>
                                        <option value="alfa">Альфа-Банк</option>
                                        <option value="gazprom">Газпромбанк</option>
                                        <option value="raif">Райффайзен</option>
                                        <option value="other">Другой...</option>
                                    </select>
                                    <input type="text" class="account-number" placeholder="Номер счёта" />
                                </div>
                            </div>

                            <div class="transfer-details">
                                <div class="amount-field">
                                    <label>Сумма</label>
                                    <input type="number" placeholder="0 ₽" />
                                </div>
                                
                                <div class="schedule-field">
                                    <label>Дата ежемесячного перевода</label>
                                    <input type="number" min="1" max="31" placeholder="День месяца" />
                                </div>

                                <div class="note-field">
                                    <label>Примечание</label>
                                    <input type="text" placeholder="Например: Ипотека" />
                                </div>
                            </div>

                            <button class="save-transfer">Сохранить</button>
                        </div>
                    </div>

                    <!-- Список запланированных переводов -->
                    <div class="planned-transfers">
                        <!-- Здесь будут отображаться сохраненные переводы -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальное окно календаря -->
        <div class="calendar-modal">
            <div class="calendar-header">
                <button class="back-button">
                    <span class="material-icons">arrow_back</span>
                    <span>Назад</span>
                </button>
                <div class="calendar-title-container">
                    <div class="month-title"></div>
                </div>
            </div>
            <div class="calendar-grid">
                <!-- Дни недели и числа будут добавлены через JavaScript -->
            </div>
        </div>

        <!-- Всплывающее мини-окно для ввода данных -->
        <div class="popup-form">
            <div class="popup-content">
                <div class="popup-inputs">
                    <div class="form-group">
                        <input type="number" id="popup-amount" placeholder="0 ₽" required>
                    </div>
                    <div class="form-group">
                        <input type="date" id="popup-date" required>
                    </div>
                    <div class="form-group">
                        <input type="text" id="popup-note" placeholder="Добавить заметку">
                    </div>
                    <input type="hidden" id="popup-category">
                    <input type="hidden" id="popup-type">
                </div>
                <button type="button" class="popup-submit-button" id="popup-submit">
                    <span class="material-icons">check_circle</span>
                </button>
            </div>
        </div>

        <!-- Модальное окно отчетов -->
        <div class="reports-modal">
            <div class="modal-header">
                <button class="close-button">
                    <span class="material-icons">close</span>
                </button>
                <div class="report-type-switch">
                    <button class="expense-button active">Расходы</button>
                    <button class="income-button">Доходы</button>
                </div>
                <div class="period-switch">
                    <button class="period-button active">Месяц</button>
                    <button class="period-button">Год</button>
                </div>
            </div>
            <div class="reports-content">
                <!-- Навигация по датам -->
                <div class="date-navigation">
                    <div class="date-text">окт. 2024 г.</div>
                    <div class="chart-navigation">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot active"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                </div>

                <!-- Круговая диаграмма -->
                <div class="chart-container">
                    <canvas id="expenseChart" width="200" height="200"></canvas>
                    <div class="chart-total">111</div>
                </div>

                <!-- Список категорий -->
                <div class="category-list">
                    <!-- Категории будут добавлены динамически через JavaScript -->
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
    <script>
        // Непосредственное добавление обработчика при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Сразу инициализируем отчеты
            initializeReports();
            
            // Прямая привязка к кнопке отчетов
            const reportsButton = document.querySelector('.nav-item[data-page="reports"]');
            if (reportsButton) {
                reportsButton.onclick = function() {
                    console.log('Direct reports click handler');
                    const reportsModal = document.querySelector('.reports-modal');
                    reportsModal.classList.add('active');
                    
                    // Принудительное обновление категорий несколько раз с разными интервалами
                    setTimeout(reapplyCategories, 50);
                    setTimeout(reapplyCategories, 100);
                    setTimeout(reapplyCategories, 200);
                    setTimeout(reapplyCategories, 500);
                };
            }

            // Прямая привязка к кнопке закрытия
            const closeButton = document.querySelector('.reports-modal .close-button');
            if (closeButton) {
                closeButton.onclick = function() {
                    console.log('Direct close click handler');
                    document.querySelector('.reports-modal').classList.remove('active');
                };
            }
            
            // Принудительное обновление категорий при загрузке страницы
            setTimeout(reapplyCategories, 100);
            setTimeout(reapplyCategories, 500);
            setTimeout(reapplyCategories, 1000);
        });
    </script>
    
    <!-- Инлайн-скрипт для гарантированного отображения категорий -->
    <script>
        (function() {
            // Принудительное добавление категорий без зависимостей от других функций
            function setCategories() {
                const categoryList = document.querySelector('.reports-modal .category-list');
                if (categoryList) {
                    // Категории будут добавлены динамически через updateReport
                    categoryList.innerHTML = '';
                }
            }
            
            // Инициализация диаграммы напрямую
            function setChart() {
                const ctx = document.getElementById('expenseChart')?.getContext('2d');
                if (!ctx) return;
                
                // Если диаграмма уже существует, уничтожаем ее
                if (window.expenseChart instanceof Chart) {
                    window.expenseChart.destroy();
                }
                
                // Создаем новую диаграмму (пустую, которая будет заполнена через updateReport)
                window.expenseChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [],
                            borderWidth: 0,
                            hoverOffset: 0,
                            spacing: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        rotation: 0,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: false
                            }
                        },
                        animation: {
                            animateRotate: true,
                            animateScale: false
                        }
                    }
                });
            }
            
            // Добавить кнопке отчетов событие клика
            window.addEventListener('load', function() {
                const reportsButton = document.querySelector('.nav-item[data-page="reports"]');
                if (reportsButton) {
                    reportsButton.addEventListener('click', function() {
                        // Обновляем категории и диаграмму несколько раз для надежности
                        setTimeout(function() {
                            setCategories();
                            setChart();
                        }, 0);
                        setTimeout(function() {
                            setCategories();
                            setChart();
                        }, 100);
                        setTimeout(function() {
                            setCategories();
                            setChart();
                        }, 300);
                    });
                }
                
                // Установить категории и диаграмму сразу
                setCategories();
                setChart();
                
                // И еще раз с задержкой для надежности
                setTimeout(function() {
                    setCategories();
                    setChart();
                }, 500);
            });
        })();
    </script>
    <script>
        function reapplyCategories() {
            console.log('Reapplying categories HTML and refreshing data');
            
            // Обновляем отчет с актуальными данными
            if (typeof updateReport === 'function') {
                // Если функция определена, вызываем ее
                updateReport();
            } else {
                // Временная загрузка данных, если функция еще не определена
                console.log('updateReport function not available, using fallback');
                const categoryList = document.querySelector('.reports-modal .category-list');
                if (categoryList) {
                    // Очищаем список категорий (будет заполнен через updateReport)
                    categoryList.innerHTML = '';
                }
                
                // Обновляем диаграмму с временными данными (пустую)
                const ctx = document.getElementById('expenseChart')?.getContext('2d');
                if (ctx) {
                    console.log('Initializing expense chart with fallback data');
                    
                    // Если диаграмма уже существует, уничтожаем ее
                    if (window.expenseChart instanceof Chart) {
                        window.expenseChart.destroy();
                    }
                    
                    // Создаем новую диаграмму (пустую)
                    window.expenseChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: [],
                            datasets: [{
                                data: [],
                                backgroundColor: [],
                                borderWidth: 0,
                                hoverOffset: 0,
                                spacing: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '70%',
                            rotation: 0,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    enabled: false
                                }
                            },
                            animation: {
                                animateRotate: true,
                                animateScale: false
                            }
                        }
                    });
                    console.log('Chart initialized with fallback data');
                }
            }
        }
    </script>
</body>
</html> 